<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Token Map</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background: #f0f0f0;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            display: flex;
            gap: 20px;
        }
        
        .main-game {
            flex: 1;
        }
        
        .sidebar {
            width: 220px;
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            border: 2px solid #e9ecef;
            max-height: 600px;
            overflow-y: auto;
        }
        
        .sidebar h3 {
            margin: 0 0 15px 0;
            color: #333;
            font-size: 16px;
        }
        
        .token-types {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .token-type {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px;
            border: 2px solid #ddd;
            border-radius: 5px;
            cursor: pointer;
            background: white;
            transition: all 0.2s;
        }
        
        .token-type:hover {
            border-color: #4CAF50;
            background: #f0f8f0;
        }
        
        .token-type.selected {
            border-color: #4CAF50;
            background: #e8f5e8;
        }
        
        .token-preview {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            border: 2px solid #333;
        }
        
        .token-label {
            font-size: 12px;
            font-weight: bold;
        }
        
        .dice-section {
            margin-top: 25px;
            padding-top: 15px;
            border-top: 2px solid #e9ecef;
        }
        
        .dice-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin: 10px 0;
        }
        
        .dice-control {
            display: flex;
            align-items: center;
            background: white;
            border: 2px solid #ddd;
            border-radius: 4px;
            padding: 5px;
        }
        
        .dice-label {
            font-size: 11px;
            font-weight: bold;
            margin-right: 5px;
            min-width: 25px;
        }
        
        .dice-input {
            width: 30px;
            border: none;
            text-align: center;
            font-size: 12px;
            background: transparent;
        }
        
        .dice-input:focus {
            outline: none;
            background: #f0f8f0;
        }
        
        .roll-button {
            background: #FF6B35;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            width: 100%;
            margin: 8px 0;
        }
        
        .roll-button:hover {
            background: #E55A2B;
        }
        
        .dice-results {
            background: white;
            border: 2px solid #ddd;
            border-radius: 5px;
            padding: 8px;
            margin: 8px 0;
            min-height: 60px;
            font-size: 12px;
        }
        
        .roll-total {
            font-weight: bold;
            font-size: 16px;
            color: #FF6B35;
            margin: 5px 0;
        }
        
        .roll-details {
            color: #666;
            font-size: 11px;
            line-height: 1.3;
        }
        
        .preset-rolls {
            display: flex;
            flex-direction: column;
            gap: 4px;
            margin: 8px 0;
        }
        
        .preset-button {
            background: #6C63FF;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 10px;
            font-weight: bold;
        }
        
        .preset-button:hover {
            background: #5A52E8;
        }
        
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 20px;
        }
        
        #gameCanvas {
            border: 2px solid #333;
            cursor: grab;
            display: block;
            margin: 0 auto;
            background: #e8f4f8;
        }
        
        #gameCanvas:active {
            cursor: grabbing;
        }
        
        .controls {
            text-align: center;
            margin-top: 15px;
            color: #666;
        }
        
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        
        button:hover {
            background: #45a049;
        }
        
        .info {
            margin-top: 10px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="sidebar">
            <h3>üéÆ Token Types</h3>
            <div class="token-types" id="tokenTypes">
                <!-- Token types will be populated by JavaScript -->
            </div>
            
            <div class="dice-section">
                <h3>üé≤ Dice Roller</h3>
                
                <div class="dice-grid">
                    <div class="dice-control">
                        <span class="dice-label">d4:</span>
                        <input type="number" class="dice-input" id="d4" min="0" max="20" value="0">
                    </div>
                    <div class="dice-control">
                        <span class="dice-label">d6:</span>
                        <input type="number" class="dice-input" id="d6" min="0" max="20" value="0">
                    </div>
                    <div class="dice-control">
                        <span class="dice-label">d8:</span>
                        <input type="number" class="dice-input" id="d8" min="0" max="20" value="0">
                    </div>
                    <div class="dice-control">
                        <span class="dice-label">d10:</span>
                        <input type="number" class="dice-input" id="d10" min="0" max="20" value="0">
                    </div>
                    <div class="dice-control">
                        <span class="dice-label">d12:</span>
                        <input type="number" class="dice-input" id="d12" min="0" max="20" value="0">
                    </div>
                    <div class="dice-control">
                        <span class="dice-label">d20:</span>
                        <input type="number" class="dice-input" id="d20" min="0" max="20" value="1">
                    </div>
                    <div class="dice-control">
                        <span class="dice-label">d100:</span>
                        <input type="number" class="dice-input" id="d100" min="0" max="10" value="0">
                    </div>
                    <div class="dice-control">
                        <span class="dice-label">Mod:</span>
                        <input type="number" class="dice-input" id="modifier" min="-50" max="50" value="0">
                    </div>
                </div>
                
                <button class="roll-button" onclick="rollDice()">üé≤ ROLL!</button>
                
                <div class="preset-rolls">
                    <button class="preset-button" onclick="setDicePreset('attack')">‚öîÔ∏è Attack (d20+mod)</button>
                    <button class="preset-button" onclick="setDicePreset('damage')">üí• Damage (d8+mod)</button>
                    <button class="preset-button" onclick="setDicePreset('stats')">üìä Stats (4d6)</button>
                    <button class="preset-button" onclick="setDicePreset('initiative')">üèÉ Initiative (d20+mod)</button>
                </div>
                
                <div class="dice-results" id="diceResults">
                    <div style="text-align: center; color: #999; font-style: italic;">
                        Set dice quantities and roll!
                    </div>
                </div>
            </div>
        </div>
        
        <div class="main-game">
            <h1>üó∫Ô∏è Interactive Token Map</h1>
            <canvas id="gameCanvas" width="800" height="600"></canvas>
            
            <div class="controls">
                <button onclick="addToken()">Add Token</button>
                <button onclick="clearTokens()">Clear All</button>
                <div class="info">
                    <p>üéØ Select token type from sidebar ‚Ä¢ Drag tokens around ‚Ä¢ Right-click to remove</p>
                    <p id="tokenCount">Tokens: 0</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        // Game state
        let tokens = [];
        let draggedToken = null;
        let dragOffset = { x: 0, y: 0 };
        let mousePos = { x: 0, y: 0 };
        let selectedTokenType = 0;
        
        // Token types with emojis/symbols
        const tokenTypes = [
            { name: 'Hero', color: '#FF6B6B', symbol: 'üó°Ô∏è' },
            { name: 'Mage', color: '#4ECDC4', symbol: 'üîÆ' },
            { name: 'Archer', color: '#45B7D1', symbol: 'üèπ' },
            { name: 'Guard', color: '#96CEB4', symbol: 'üõ°Ô∏è' },
            { name: 'Rogue', color: '#FFEAA7', symbol: 'üó°Ô∏è' },
            { name: 'Monster', color: '#DDA0DD', symbol: 'üëæ' },
            { name: 'Dragon', color: '#FFA07A', symbol: 'üêâ' },
            { name: 'Treasure', color: '#98D8C8', symbol: 'üíé' }
        ];
        
        // Token class
        class Token {
            constructor(x, y, type, id) {
                this.x = x;
                this.y = y;
                this.type = type;
                this.radius = 20;
                this.id = id;
            }
            
            draw() {
                // Shadow
                ctx.shadowColor = 'rgba(0,0,0,0.3)';
                ctx.shadowBlur = 5;
                ctx.shadowOffsetX = 2;
                ctx.shadowOffsetY = 2;
                
                // Token body
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                ctx.fillStyle = this.type.color;
                ctx.fill();
                ctx.strokeStyle = '#333';
                ctx.lineWidth = 2;
                ctx.stroke();
                
                // Reset shadow
                ctx.shadowColor = 'transparent';
                ctx.shadowBlur = 0;
                ctx.shadowOffsetX = 0;
                ctx.shadowOffsetY = 0;
                
                // Token symbol
                ctx.font = '16px Arial';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(this.type.symbol, this.x, this.y);
            }
            
            contains(x, y) {
                const dx = x - this.x;
                const dy = y - this.y;
                return dx * dx + dy * dy <= this.radius * this.radius;
            }
        }
        
        // Draw the map background
        function drawMap() {
            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw grid
            ctx.strokeStyle = '#ddd';
            ctx.lineWidth = 1;
            
            for (let x = 0; x <= canvas.width; x += 40) {
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, canvas.height);
                ctx.stroke();
            }
            
            for (let y = 0; y <= canvas.height; y += 40) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(canvas.width, y);
                ctx.stroke();
            }
            
            // Draw some map features (optional decorations)
            drawMapFeatures();
        }
        
        function drawMapFeatures() {
            // Draw some simple terrain features
            ctx.fillStyle = '#90EE90';
            ctx.fillRect(100, 100, 150, 80); // Forest
            ctx.fillStyle = '#8B4513';
            ctx.fillRect(120, 120, 110, 40); // Mountain
            
            ctx.fillStyle = '#87CEEB';
            ctx.beginPath();
            ctx.arc(600, 300, 60, 0, Math.PI * 2); // Lake
            ctx.fill();
            
            // Labels for features
            ctx.fillStyle = '#333';
            ctx.font = '14px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('Forest', 175, 190);
            ctx.fillText('Lake', 600, 380);
        }
        
        // Get mouse position relative to canvas
        function getMousePos(e) {
            const rect = canvas.getBoundingClientRect();
            return {
                x: e.clientX - rect.left,
                y: e.clientY - rect.top
            };
        }
        
        // Find token at position
        function getTokenAt(x, y) {
            for (let i = tokens.length - 1; i >= 0; i--) {
                if (tokens[i].contains(x, y)) {
                    return tokens[i];
                }
            }
            return null;
        }
        
        // Add a new token
        function addToken() {
            const x = Math.random() * (canvas.width - 40) + 20;
            const y = Math.random() * (canvas.height - 40) + 20;
            const type = tokenTypes[selectedTokenType];
            const token = new Token(x, y, type, tokens.length + 1);
            tokens.push(token);
            updateTokenCount();
            render();
        }
        
        // Create sidebar token type selector
        function createTokenTypeSelector() {
            const container = document.getElementById('tokenTypes');
            
            tokenTypes.forEach((type, index) => {
                const typeElement = document.createElement('div');
                typeElement.className = `token-type ${index === selectedTokenType ? 'selected' : ''}`;
                typeElement.onclick = () => selectTokenType(index);
                
                const preview = document.createElement('div');
                preview.className = 'token-preview';
                preview.style.backgroundColor = type.color;
                preview.textContent = type.symbol;
                
                const label = document.createElement('div');
                label.className = 'token-label';
                label.textContent = type.name;
                
                typeElement.appendChild(preview);
                typeElement.appendChild(label);
                container.appendChild(typeElement);
            });
        }
        
        // Select token type
        function selectTokenType(index) {
            selectedTokenType = index;
            
            // Update visual selection
            document.querySelectorAll('.token-type').forEach((el, i) => {
                el.classList.toggle('selected', i === index);
            });
        }
        
        // Dice rolling functionality
        function rollDice() {
            const diceTypes = ['d4', 'd6', 'd8', 'd10', 'd12', 'd20', 'd100'];
            const modifier = parseInt(document.getElementById('modifier').value) || 0;
            
            let totalRoll = 0;
            let rollDetails = [];
            let hasRolls = false;
            
            // Roll each type of dice
            diceTypes.forEach(diceType => {
                const count = parseInt(document.getElementById(diceType).value) || 0;
                if (count > 0) {
                    hasRolls = true;
                    const sides = parseInt(diceType.substring(1));
                    const rolls = [];
                    let subtotal = 0;
                    
                    for (let i = 0; i < count; i++) {
                        const roll = Math.floor(Math.random() * sides) + 1;
                        rolls.push(roll);
                        subtotal += roll;
                    }
                    
                    totalRoll += subtotal;
                    rollDetails.push(`${count}${diceType}: [${rolls.join(', ')}] = ${subtotal}`);
                }
            });
            
            if (!hasRolls && modifier === 0) {
                document.getElementById('diceResults').innerHTML = 
                    '<div style="text-align: center; color: #999; font-style: italic;">Set dice quantities and roll!</div>';
                return;
            }
            
            // Add modifier
            if (modifier !== 0) {
                totalRoll += modifier;
                rollDetails.push(`Modifier: ${modifier >= 0 ? '+' : ''}${modifier}`);
            }
            
            // Display results
            const resultsDiv = document.getElementById('diceResults');
            resultsDiv.innerHTML = `
                <div class="roll-total">Total: ${totalRoll}</div>
                <div class="roll-details">${rollDetails.join('<br>')}</div>
            `;
        }
        
        // Preset dice combinations
        function setDicePreset(preset) {
            // Clear all dice first
            ['d4', 'd6', 'd8', 'd10', 'd12', 'd20', 'd100'].forEach(dice => {
                document.getElementById(dice).value = 0;
            });
            document.getElementById('modifier').value = 0;
            
            switch(preset) {
                case 'attack':
                    document.getElementById('d20').value = 1;
                    document.getElementById('modifier').value = 5; // Common attack bonus
                    break;
                case 'damage':
                    document.getElementById('d8').value = 1;
                    document.getElementById('modifier').value = 3; // Common damage bonus
                    break;
                case 'stats':
                    document.getElementById('d6').value = 4;
                    document.getElementById('modifier').value = 0;
                    break;
                case 'initiative':
                    document.getElementById('d20').value = 1;
                    document.getElementById('modifier').value = 2; // Common dex modifier
                    break;
            }
        }
        
        // Add keyboard support for dice rolling
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && e.target.classList.contains('dice-input')) {
                rollDice();
            }
        });
        
        // Clear all tokens
        function clearTokens() {
            tokens = [];
            draggedToken = null;
            updateTokenCount();
            render();
        }
        
        // Update token counter
        function updateTokenCount() {
            document.getElementById('tokenCount').textContent = `Tokens: ${tokens.length}`;
        }
        
        // Render everything
        function render() {
            drawMap();
            tokens.forEach(token => token.draw());
        }
        
        // Mouse event handlers
        canvas.addEventListener('mousedown', (e) => {
            mousePos = getMousePos(e);
            const token = getTokenAt(mousePos.x, mousePos.y);
            
            if (token) {
                draggedToken = token;
                dragOffset = {
                    x: mousePos.x - token.x,
                    y: mousePos.y - token.y
                };
                canvas.style.cursor = 'grabbing';
            }
        });
        
        canvas.addEventListener('mousemove', (e) => {
            mousePos = getMousePos(e);
            
            if (draggedToken) {
                // Update token position
                draggedToken.x = mousePos.x - dragOffset.x;
                draggedToken.y = mousePos.y - dragOffset.y;
                
                // Keep token within bounds
                draggedToken.x = Math.max(draggedToken.radius, Math.min(canvas.width - draggedToken.radius, draggedToken.x));
                draggedToken.y = Math.max(draggedToken.radius, Math.min(canvas.height - draggedToken.radius, draggedToken.y));
                
                render();
            } else {
                // Change cursor based on whether hovering over token
                const token = getTokenAt(mousePos.x, mousePos.y);
                canvas.style.cursor = token ? 'grab' : 'default';
            }
        });
        
        canvas.addEventListener('mouseup', () => {
            draggedToken = null;
            canvas.style.cursor = 'default';
        });
        
        // Right-click to remove token
        canvas.addEventListener('contextmenu', (e) => {
            e.preventDefault();
            mousePos = getMousePos(e);
            const token = getTokenAt(mousePos.x, mousePos.y);
            
            if (token) {
                const index = tokens.indexOf(token);
                tokens.splice(index, 1);
                updateTokenCount();
                render();
            }
        });
        
        // Handle mouse leave
        canvas.addEventListener('mouseleave', () => {
            draggedToken = null;
            canvas.style.cursor = 'default';
        });
        
        // Initialize with a few tokens
        createTokenTypeSelector();
        addToken();
        addToken();
        addToken();
        
        // Initial render
        render();
    </script>
</body>
</html>
